==============================================================================
README
==============================================================================

UCVM - Unified Community Velocity Model Framework
Release 14.7.0
June 30, 2014
http://scec.usc.edu/scecpedia/UCVM_14.7.0


1.0 Requirements
================

The system requirements are as follows: 

- UNIX operating system (Linux and Mac OS X) 
- GNU gcc/gfortran compilers (MPI wrappers such as mpicc are OK) 
- Python 2.5+
- tar for opening the compressed files 
- Euclid Etree library: http://www.cs.cmu.edu/~euclid/
- Proj.4 projection library: http://trac.osgeo.org/proj/

Optional dependencies include any of the following standard velocity models
and packages:

- Standard community velocity models: SCEC CVM-H, SCEC CVM-S, SCEC CVM-SI, 
  SCEC CVM-NCI, Magistrale WFCVM, USGS CenCalVM, Graves Cape Mendocino, 
  Lin-Thurber Statewide, Tape SoCal
- NetCDF: http://www.unidata.ucar.edu/downloads/netcdf/index.jsp


2.0 Installation (Easy Way)
================

The basic install of UCVM is simple:

$ tar zxvf ucvm-14.7.0.tar.gz
$ cd UCVM
$ ./ucvm_setup.py

Then simply answer all the questions in the script. It will ask you which models
you would like to install (CVM-S5, CVM-S4, CVM-H, and CenCal).

The script will then automatically download and install the models you selected.

The default is to link statically. If you would like to enable dynamic linking, please
use the argument -s. E.g. ./ucvm_setup.py -s


3.0 Installation (Hard Way)
================

3.1 Quick Start

The steps to install the minimum distribution are as follows:

$ tar zxvf ucvm-14.7.0.tar.gz
$ cd UCVM
$ ./configure --prefix=${UCVM_INSTALL_DIR} 
  --with-etree-include-path="${ETREE_DIR}/libsrc" 
  --with-etree-lib-path="${ETREE_DIR}/libsrc" 
  --with-proj4-include-path="${PROJ4_DIR}/include" 
  --with-proj4-lib-path="${PROJ4_DIR}/lib"
$ make
$ make check
$ make install

Where ${UCVM_INSTALL_DIR} is the directory where you wish to install UCVM, and 
${ETREE_DIR} and ${PROJ4_DIR} are the paths where the Etree and Proj.4 
packages are installed. The 'make check' command executes a set of unit and 
acceptance tests which confirms that the package was built successfully. All 
the tests should pass.

With this setup, only the "1d", "lin-thurber", and "cmrg" standard models 
will be available for query. To install support for another standard model,
please see the following section.


3.2 Installation with a Standard Velocity Model

If you wish to link in a external standard velocity model, you must tell the 
configure script where it can find the model libraries, headers, and model 
files. This is done with the '--with-model_name-lib-path', 
'--with-model_name-include-path', '--with-model_name-model-path' (and
optionally '--with-model_name-extmodel-path', '--with-gctpc-lib-path') options. 

For example, to link UCVM with the SCEC CVM-H velocity model, run configure 
with the following commands:

$ ./configure --prefix=${UCVM_INSTALL_DIR} 
  --with-etree-include-path="${ETREE_DIR}/libsrc" 
  --with-etree-lib-path="${ETREE_DIR}/libsrc" 
  --with-proj4-include-path="${PROJ4_DIR}/include" 
  --with-proj4-lib-path="${PROJ4_DIR}/lib"
  --with-cvmh-include-path="${CVMH_DIR}/include" 
  --with-cvmh-lib-path="${CVMH_DIR}/lib" 
  --with-gctpc-lib-path="${CVMH_DIR}/gctpc/lib"
  --with-cvmh-model-path="${CVMH_DIR}/bin"
$ make
$ make check
$ make install

Where ${CVMH_DIR} is the directory where SCEC CVM-H is installed. Note that 
SCEC CVM-H 11.9.1 has a dependency on the GCTPC projection package (which is
distributed with CVM-H, but UCVM needs to link that library as well). The 
configure script is told where to find it with the '--with-gctpc-lib-path' 
option. The rest of the make process is generally the same as the quick start 
example, except now the package tests will include CVM-H tests to verify that 
the linking was successful.

Any number of supported velocity models may be linked into UCVM in this 
manner, using the appropriate options. Execute './configure --help' to see the 
full list of support models and their options.


4.0 Technical Notes
===================

4.1 MPI Compilers

If a GNU-based MPI compiler is detected, the MPI version of ucvm2etree are
built. Otherwise, the serial version is built.


4.2 Lustre Filesystems

The IOBUF module must be used when compiling the Etree library and UCVM for 
use on a Lustre high-performance filesystem. Please reference the Euclid Etree 
documention for instructions on how to do this for that package. For UCVM, 
IOBUF is enabled with the following configuration commands:

$ module add iobuf          # System dependent
$ ./configure --prefix=${UCVM_INSTALL_DIR} --enable-iobuf
  --with-etree-include-path="${ETREE_DIR}/libsrc" 
  --with-etree-lib-path="${ETREE_DIR}/libsrc" 
  --with-proj4-include-path="${PROJ4_DIR}/include" 
  --with-proj4-lib-path="${PROJ4_DIR}/lib"

Note the use of the '--enable-iobuf' option.


4.3 Static Builds

A static build can be forced with the '--enable-static' configure option.


5.0 Configuration
=================

The main application configuration file is ${UCVM_INSTALL_DIR}/conf/ucvm.conf. 
This is where the paths to all configured models and maps are specified, as 
well as any model flags are defined. The UCVM installer sets up this file 
automatically. Yet there are a number of situations where you will want to 
modify it, such as to add a new model.

Please see the User Guide for more details on how to edit the UCVM config.


5.1 Standard Models

The standard models are referenced with the following labels:

cvmh	     	    SCEC CVM-H
cvms	     	    SCEC CVM-S4
cencal	     	    USGS Bay Area CenCalVM
cvmnci		    	SCE CVM-NCI
cvmsi	     	    SCEC CVM-S4.23
wfcvm	     	    WFCVM
1d		    		Hadley-Kanamori 1D (pre-linked)
lt	    	    	Lin-Thurber California Statewide
cmrg		    	Cape Mendocino Rob Graves
tape		    	Tape SoCal

Note that the model must be linked in at install time if it is to be queried 
through UCVM.


5.2 Standard Maps

ucvm	     USGS NED DEM and Wills-Wald Vs30 (default)
yong	     USGS NED DEM and Yong-Wald Vs30



6.0 Documentation
=================

Online documentation is available at:

http://scec.usc.edu/scecpedia/UCVM_14.7.0


7.0 License
===========

Please see LICENSE for the distribution license and disclaimers.

